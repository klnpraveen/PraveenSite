!function(e){"use strict";function t(t){var n=t.selector;t.each(function(){var t="fancyInput",n=e('<div><b class="caret">&#8203;</b></div>');"TEXTAREA"==this.tagName&&(t+=" textarea"),e(this.parentNode).append(n).addClass(t),this.value&&l.fillText(this.value,this),this.placeholder&&(n.attr("data-placeholder",this.placeholder),this.value||n.addClass("empty"))}),e(document).off(".fi",n).on("input.fi",n,l.input).on("keypress.fi",n,l.keypress).on("keyup.fi select.fi mouseup.fi cut.fi paste.fi blur.fi",n,l.allEvents).on("mousedown.fi mouseup.fi keydown.fi",n,r.set).on("keydown.fi",n,l.keydown)}var n,i=!!window.ActiveXObject,s="webkitRequestAnimationFrame"in window;e.fn.fancyInput=function(){return(!i||"ontouchstart"in document.documentElement)&&t(this),this};var l={classToggler:"state1",keypress:function(e){var t=String.fromCharCode(e.charCode),n=this.nextElementSibling,i=this.selectionEnd,s="TEXTAREA"==this.tagName&&13==e.keyCode;if(this.selectionEnd-this.selectionStart>0&&e.charCode&&!e.metaKey&&!e.ctrlKey){var r=[this.selectionStart,this.selectionEnd];i=this.selectionStart,"rtl"==a.lastDir&&(r=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),l.removeChars(n,r)}if(e.charCode&&!e.metaKey&&!e.ctrlKey||s){var o=a.check(t);("rtl"==o||""==o&&"rtl"==a.lastDir)&&(i=this.value.length-this.selectionStart),s&&(t=""),l.maskPassword(this),l.writer(t,this,i)}},input:function(){l.textLength=this.value.length,l.inputResize(this)},maskPassword:function(t){"password"==t.type&&e(t.nextElementSibling).find("span").each(function(){this.innerHTML=""})},setCaretHeight:function(t){var i=e(t.nextElementSibling);return i.find("span").length?(n=i.find("span")[0].clientHeight,i.find("b").height(n),void 0):!1},writer:function(t,n,i){var s=e(n.nextElementSibling).children().not("b"),l=document.createElement("span");if(n.maxLength>0&&s.length>n.maxLength)return this;if(" "==t&&(t="&nbsp;"),t?(l.innerHTML=t,this.classToggler="state2"==this.classToggler?"state1":"state2",l.className=this.classToggler):l=document.createElement("br"),s.length)if(0==i)e(n.nextElementSibling).prepend(l);else{var r=s.eq(--i);r.after(l)}else n.nextElementSibling.appendChild(l);return t&&setTimeout(function(){l.removeAttribute("class")},20),this},clear:function(t){var n=e(t.parentNode).find(".caret");e(t).html(n)},fillText:function(e,t){var n,i=t.nextElementSibling,s=document.createDocumentFragment();l.clear(t.nextElementSibling),setTimeout(function(){for(var t=e.length,l=0;t>l;l++){var r="span";"\n"==e[l]&&(r="br"),n=document.createElement(r),n.innerHTML=" "==e[l]?"&nbsp;":e[l],s.appendChild(n)}i.appendChild(s)},0)},removeChars:function(t,n){{var i,l=e(t).children().not("b").not(".deleted");e(t).find("b")}n[0]==n[1]&&n[0]--,i=l.slice(n[0],n[1]),n[1]-n[0]==1?(i.css("position","absolute"),s&&i[0].offsetLeft,i.addClass("deleted"),setTimeout(function(){i.remove()},140)):i.remove()},inputResize:function(t){if("TEXTAREA"==t.tagName&&setTimeout(function(){t.style.top="-999px";var n=t.parentNode.scrollHeight;e(t).outerHeight()<t.parentNode.scrollHeight&&(n+=10),t.style.height=n+"px",t.style.top="0",setTimeout(function(){t.scrollTop=0,t.parentNode.scrollTop=9999},50)},0),"INPUT"==t.tagName&&"text"==t.type){t.style.width=0;var n=t.parentNode.scrollWidth;t.parentNode.scrollWidth>t.parentNode.clientWidth&&(n+=20),t.style.width=n+"px"}},keydown:function(e){var t=(String.fromCharCode(e.charCode),this.nextElementSibling),n=(this.selectionEnd,(e.metaKey||e.ctrlKey)&&90==e.keyCode||e.altKey&&8==e.keyCode),i=(e.metaKey||e.ctrlKey)&&89==e.keyCode,s=(e.metaKey||e.ctrlKey)&&65==e.keyCode,r=this.selectionEnd==this.selectionStart&&this.selectionEnd==this.value.length,o=46==e.keyCode&&!r;if(l.setCaret(this),s)return!0;if(n||i)return setTimeout(function(){l.fillText(e.target.value,e.target)},50),!0;if(8==e.keyCode||o){var c=[this.selectionStart,this.selectionEnd];"rtl"==a.lastDir&&(c=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),o&&this.selectionEnd==this.selectionStart&&this.selectionEnd<this.value.length?(c[0]+=1,c[1]+=1,l.removeChars(t,c)):setTimeout(function(){(e.metaKey||e.ctrlKey)&&(c=[e.target.selectionStart,c[0]]),l.removeChars(t,c)},0)}return 0==this.selectionStart&&(this.parentNode.scrollLeft=0),!0},allEvents:function(e){l.setCaret(this),"paste"==e.type&&setTimeout(function(){l.fillText(e.target.value,e.target),l.inputResize(e.target)},20),"cut"==e.type&&l.removeChars(this.nextElementSibling,[this.selectionStart,this.selectionEnd]),(!e.keyCode||e.keyCode<50)&&l.maskPassword(this),n||setTimeout(function(){l.setCaretHeight(e.target)},150),this.selectionStart==this.value.length&&(this.parentNode.scrollLeft=999999),this.nextElementSibling.className=this.value?"":"empty"},setCaret:function(t){var n=e(t.parentNode).find(".caret"),i=e(t.nextElementSibling).children().not("b"),s=i.not(".deleted"),r=l.getCaretPosition(t);"rtl"==a.lastDir&&(r=t.value.length-r);var o=s.eq(r);r==t.value.length?n.appendTo(t.nextElementSibling):n.insertBefore(o)},getCaretPosition:function(e){var t,n=r.direction||"right";return(e.selectionStart||"0"==e.selectionStart)&&(t="left"==n?e.selectionStart:e.selectionEnd),t||0}},r={direction:null,lastOffset:null,set:function(e){var t;e.shiftKey&&37==e.keyCode?t="left":e.shiftKey&&39==e.keyCode&&(t="right"),"mousedown"==e.type?r.lastOffset=e.clientX:"mouseup"==e.type&&(t=e.clientX<r.lastOffset?"left":"right"),r.direction=t}},a={lastDir:null,check:function(e){var t="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",n="֑-߿יִ-﷽ﹰ-ﻼ",i=new RegExp("^[^"+n+"]*["+t+"]"),s=new RegExp("^[^"+t+"]*["+n+"]"),l=s.test(e)?"rtl":i.test(e)?"ltr":"";return l&&(this.lastDir=l),l}};window.fancyInput=l}(window.jQuery);