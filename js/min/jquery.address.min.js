!function(e){e.address=function(){var t,r,n,a=function(t){e(e.address).trigger(e.extend(e.Event(t),function(){for(var t={},r=e.address.parameterNames(),n=0,a=r.length;a>n;n++)t[r[n]]=e.address.parameter(r[n]);return{value:e.address.value(),path:e.address.path(),pathNames:e.address.pathNames(),parameterNames:r,parameters:t,queryString:e.address.queryString()}}.call(e.address)))},i=function(t,r,n){return e(e.address).bind(t,r,n),e.address},s=function(){return Z.pushState&&P.state!==t},o=function(){return("/"+et.pathname.replace(new RegExp(P.state),"")+et.search+(c()?"#"+c():"")).replace(it,"/")},c=function(){var e=et.href.indexOf("#");return-1!=e?f(et.href.substr(e+1),W):""},u=function(){return s()?o():c()},d=function(){try{return top.document!==t?top:window}catch(e){return window}},l=function(){return"javascript"},h=function(e){return e=e.toString(),(P.strict&&"/"!=e.substr(0,1)?"/":"")+e},f=function(e,t){return P.crawlable&&t?(""!=e?"!":"")+e:e.replace(/^\!/,"")},p=function(e,t){return parseInt(e.css(t),10)},g=function(e){for(var t,r,n=0,a=e.childNodes.length;a>n;n++)e.childNodes[n].src&&(t=String(e.childNodes[n].src)),r=g(e.childNodes[n]),r&&(t=r);return t},v=function(){if(!lt){var e=u(),r=mt!=e;K&&523>Q?dt!=Z.length&&(dt=Z.length,vt[dt-1]!==t&&(mt=vt[dt-1]),m(W)):r&&(H&&7>Q?et.reload():(H&&8>Q&&P.history&&rt(w,50),mt=e,m(W)))}},m=function(e){a(L),a(e?z:B),rt(b,10)},b=function(){if("null"!==P.tracker&&null!==P.tracker){var r=e.isFunction(P.tracker)?P.tracker:X[P.tracker],n=(et.pathname+et.search+(e.address&&!s()?e.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");e.isFunction(r)?r(n):e.isFunction(X.urchinTracker)?X.urchinTracker(n):X.pageTracker!==t&&e.isFunction(X.pageTracker._trackPageview)?X.pageTracker._trackPageview(n):X._gaq!==t&&e.isFunction(X._gaq.push)&&X._gaq.push(["_trackPageview",decodeURI(n)])}},w=function(){var e=l()+":"+W+";document.open();document.writeln('<html><head><title>"+Y.title.replace("'","\\'")+"</title><script>var "+C+' = "'+encodeURIComponent(u())+(Y.domain!=et.hostname?'";document.domain="'+Y.domain:"")+"\";</script></head></html>');document.close();";7>Q?r.src=e:r.contentWindow.location.replace(e)},y=function(){if(ot&&-1!=ct){var e,t=ot.substr(ct+1).split("&");for(bt=0;bt<t.length;bt++)e=t[bt].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(e[0])&&(P[e[0]]=isNaN(e[1])?/^(true|yes)$/i.test(e[1]):0!==parseInt(e[1],10)),/^(state|tracker)$/.test(e[0])&&(P[e[0]]=e[1]);ot=null}mt=u()},x=function(){if(!ht){ht=M,y();var i=function(){E.call(this),N.call(this)},o=e("body").ajaxComplete(i);if(i(),P.wrap){{e("body > *").wrapAll('<div style="padding:'+(p(o,"marginTop")+p(o,"paddingTop"))+"px "+(p(o,"marginRight")+p(o,"paddingRight"))+"px "+(p(o,"marginBottom")+p(o,"paddingBottom"))+"px "+(p(o,"marginLeft")+p(o,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+C+'" style="height:100%;overflow:auto;position:relative;'+(K?window.statusbar.visible&&!/chrome/i.test(st)?"":"resize:both;":"")+'" />')}e("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),K&&e('<style type="text/css" />').appendTo("head").text("#"+C+"::-webkit-resizer { background-color: #fff; }")}if(H&&8>Q){var c=Y.getElementsByTagName("frameset")[0];r=Y.createElement((c?"":"i")+"frame"),c?(c.insertAdjacentElement("beforeEnd",r),c[c.cols?"cols":"rows"]+=",0",r.noResize=M,r.frameBorder=r.frameSpacing=0):(r.style.display="none",r.style.width=r.style.height=0,r.tabIndex=-1,Y.body.insertAdjacentElement("afterBegin",r)),rt(function(){e(r).bind("load",function(){var n=r.contentWindow;mt=n[C]!==t?e.address.decode(n[C]):"",mt!=u()&&(m(W),et.hash=f(mt,M))}),r.contentWindow[C]===t&&w()},50)}else K&&(418>Q&&(e(Y.body).append('<form id="'+C+'" style="position:absolute;top:-9999px;" method="get"></form>'),n=Y.getElementById(C)),et[C]===t&&(et[C]={}),et[C][et.pathname]!==t&&(vt=et[C][et.pathname].split(",")));rt(function(){a("init"),m(W)},1),s()||(H&&Q>7||!H&&"on"+A in X?X.addEventListener?X.addEventListener(A,v,W):X.attachEvent&&X.attachEvent("on"+A,v):tt(v,50))}},E=function(){var t,r=e("a"),n=r.size(),a=1,i=-1;rt(function(){++i!=n&&(t=e(r.get(i)),t.is('[rel*="address:"]')&&t.address(),rt(arguments.callee,a))},a)},k=function(){mt!=u()&&(mt=u(),m(W))},S=function(){X.removeEventListener?X.removeEventListener(A,v,W):X.detachEvent&&X.detachEvent("on"+A,v)},N=function(){if(P.crawlable){var t=et.pathname.replace(/\/$/,""),r="_escaped_fragment_";-1!=e("body").html().indexOf(r)&&e('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var n=e(this).attr("href").replace(/^http:/,"").replace(new RegExp(t+"/?$"),"");(""==n||-1!=n.indexOf(r))&&e(this).attr("href","#"+e.address.decode(n.replace(new RegExp("/(.*)\\?"+r+"=(.*)$"),"!$2")))})}},$=function(e){return e.replace(/\+/g," ")},I=function(e){return nt(at(e)).replace(/%20/g,"+")},O=function(e){return e.split("#")[0].split("?")[0]},R=function(e){var t=O(e),r=t.replace(it,"/").split("/");return("/"==t.substr(0,1)||0===t.length)&&r.splice(0,1),"/"==t.substr(t.length-1,1)&&r.splice(r.length-1,1),r},U=function(e){var t=e.split("?");return t.slice(1,t.length).join("?").split("#")[0]},j=function(t,r){if(r=U(r)){params=r.split("&");var n=[];for(bt=0;bt<params.length;bt++){var a=params[bt].split("=");(a[0]==t||e.address.decode(a[0])==t)&&n.push(a.slice(1).join("="))}if(0!==n.length)return 1!=n.length?n:n[0]}},T=function(t){var r=U(t),n=[];if(r&&-1!=r.indexOf("="))for(var a=r.split("&"),i=0;i<a.length;i++){var s=a[i].split("=")[0];-1==e.inArray(s,n)&&n.push(s)}return n},_=function(e){var t=e.split("#");return t.slice(1,t.length).join("#")},C="jQueryAddress",q="string",A="hashchange",F="init",L="change",z="internalChange",B="externalChange",M=!0,W=!1,P={autoUpdate:M,crawlable:W,history:M,strict:M,wrap:W},D=e.browser,Q=parseFloat(e.browser.version),G=D.mozilla,H=D.msie,J=D.opera,K=D.webkit||D.safari,V=W,X=d(),Y=X.document,Z=X.history,et=X.location,tt=setInterval,rt=setTimeout,nt=encodeURIComponent,at=decodeURIComponent,it=/\/{2,9}/g,st=navigator.userAgent,ot=g(document),ct=ot?ot.indexOf("?"):-1,ut=Y.title,dt=Z.length,lt=W,ht=W,ft=M,pt=M,gt=W,vt=[],mt=u();if(H&&(Q=parseFloat(st.substr(st.indexOf("MSIE")+4)),Y.documentMode&&Y.documentMode!=Q&&(Q=8!=Y.documentMode?7:8),e(document).bind("propertychange",function(){Y.title!=ut&&-1!=Y.title.indexOf("#"+u())&&(Y.title=ut)})),V=G&&Q>=1||H&&Q>=6||J&&Q>=9.5||K&&Q>=312){for(var bt=1;dt>bt;bt++)vt.push("");if(vt.push(mt),J&&(history.navigationMode="compatible"),"complete"==document.readyState)var wt=setInterval(function(){e.address&&(x(),clearInterval(wt))},50);else y(),e(x);var yt=o();P.state!==t&&(Z.pushState?"/#/"==yt.substr(0,3)&&et.replace(P.state.replace(/^\/$/,"")+yt.substr(2)):"/"!=yt&&yt.replace(/^\/#/,"")!=c()&&et.replace(P.state.replace(/^\/$/,"")+"/#"+yt)),e(window).bind({popstate:k,unload:S})}else!V&&""!=c()||K&&418>Q&&""!=c()&&""!=et.search?et.replace(et.href.substr(0,et.href.indexOf("#"))):b();return{bind:function(e,t,r){return i(e,t,r)},init:function(e){return i(F,e)},change:function(e){return i(L,e)},internalChange:function(e){return i(z,e)},externalChange:function(e){return i(B,e)},baseURL:function(){var e=et.href;return-1!=e.indexOf("#")&&(e=e.substr(0,e.indexOf("#"))),/\/$/.test(e)&&(e=e.substr(0,e.length-1)),e},autoUpdate:function(e){return e!==t?(P.autoUpdate=e,this):P.autoUpdate},crawlable:function(e){return e!==t?(P.crawlable=e,this):P.crawlable},history:function(e){return e!==t?(P.history=e,this):P.history},state:function(e){return e!==t?(P.state=e,this):P.state},strict:function(e){return e!==t?(P.strict=e,this):P.strict},tracker:function(e){return e!==t?(P.tracker=e,this):P.tracker},wrap:function(e){return e!==t?(P.wrap=e,this):P.wrap},update:function(){return gt=M,this.value(mt),gt=W,this},encode:function(t){var r=R(t),n=T(t),a=U(t),i=_(t),s=t.substr(0,1),o=t.substr(t.length-1),c="";return e.each(r,function(e,t){c+="/"+I(t)}),""!==a&&(c+="?",0===n.length?c+=a:(e.each(n,function(r,n){var a=j(n,t);typeof a!==q?e.each(a,function(e,t){c+=I(n)+"="+I(t)+"&"}):c+=I(n)+"="+I(a)+"&"}),c=c.substr(0,c.length-1))),""!==i&&(c+="#"+I(i)),"/"!=s&&"/"==c.substr(0,1)&&(c=c.substr(1)),"/"==s&&"/"!=c.substr(0,1)&&(c="/"+c),/#|&|\?/.test(o)&&(c+=o),c},decode:function(e){if(e!==t){var r=[],n=function(e){return at(e.toString().replace(/\+/g,"%20"))};if("object"==typeof e&&e.length!==t){for(var a=0,i=e.length;i>a;a++)r[a]=n(e[a]);return r}return n(e)}},title:function(e){return e!==t?(rt(function(){ut=Y.title=e,pt&&r&&r.contentWindow&&r.contentWindow.document&&(r.contentWindow.document.title=e,pt=W),!ft&&G&&et.replace(-1!=et.href.indexOf("#")?et.href:et.href+"#"),ft=W},50),this):Y.title},value:function(e){if(e!==t){if(e=h(e),P.autoUpdate&&(e=this.encode(e)),"/"==e&&(e=""),mt==e&&!gt)return;if(ft=M,mt=e,P.autoUpdate||gt)if(m(M),s())Z[P.history?"pushState":"replaceState"]({},"",P.state.replace(/\/$/,"")+(""==mt?"/":mt));else{if(lt=M,vt[Z.length]=mt,K)if(P.history)if(et[C][et.pathname]=vt.toString(),dt=Z.length+1,418>Q)""==et.search&&(n.action="#"+f(mt,M),n.submit());else if(523>Q||""==mt){var r=Y.createEvent("MouseEvents");r.initEvent("click",M,M);var a=Y.createElement("a");a.href="#"+f(mt,M),a.dispatchEvent(r)}else et.hash="#"+f(mt,M);else et.replace("#"+f(mt,M));else mt!=u()&&(P.history?et.hash="#"+f(this.decode(h(mt)),M):et.replace("#"+f(mt,M)));H&&8>Q&&P.history&&rt(w,50),K?rt(function(){lt=W},1):lt=W}return this}return V?this.decode(h(mt)):null},path:function(e){if(e!==t){var r=U(h(mt)),n=_(h(mt));return this.value(e+(r?"?"+r:"")+(n?"#"+n:"")),this}return this.decode(O(h(mt)))},pathNames:function(){return this.decode(R(h(mt)))},queryString:function(e){if(e!==t){var r=_(h(mt));return this.value(this.path()+(e?"?"+e:"")+(r?"#"+r:"")),this}return this.decode(U(h(mt)))},parameter:function(r,n,a){var i,s;if(n!==t){var o=this.parameterNames();for(s=[],n=n?nt(n):"",i=0;i<o.length;i++){var c=o[i],u=this.parameter(c);typeof u==q&&(u=[u]),c==r&&(u=null===n||""===n?[]:a?u.concat([n]):[n]);for(var d=0;d<u.length;d++)s.push(c+"="+$(I(u[d])))}return-1==e.inArray(r,o)&&null!==n&&""!==n&&s.push(r+"="+$(I(n))),this.queryString(s.join("&")),this}return this.decode(j(r,h(mt)))},parameterNames:function(){return this.decode(T(h(mt)))},hash:function(e){return e!==t?(this.value(h(mt).split("#")[0]+(e?"#"+e:"")),this):this.decode(_(h(mt)))}}}(),e.fn.address=function(t){if(!e(this).attr("address")){var r=function(r){if(e(this).is("a")){var n=t?t.call(this):/address:/.test(e(this).attr("rel"))?e(this).attr("rel").split("address:")[1].split(" ")[0]:void 0!==e.address.state()&&"/"!=e.address.state()?e(this).attr("href").replace(new RegExp("^(.*"+e.address.state()+"|\\.)"),""):e(this).attr("href").replace(/^(#\!?|\.)/,"");e.address.value(n),r.preventDefault()}};e(this).click(r).live("click",r).live("submit",function(r){if(e(this).is("form")){var n=e(this).attr("action"),a=t?t.call(this):(-1!=n.indexOf("?")?n.replace(/&$/,""):n+"?")+e.address.decode(e(this).serialize());e.address.value(a),r.preventDefault()}}).attr("address",!0)}return this}}(jQuery);